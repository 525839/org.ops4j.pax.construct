<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">










<html>
  <head>
    <title>maven-pax-plugin - Usage</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
          <meta name="author" content="Stuart McCulloch" />
        <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
                            <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript" src="http://www.google-analytics.com/urchin.js"></script>
                                <?xml version="1.0" encoding="UTF-8"?>
<script type="text/javascript" src="http://www.google-analytics.com/urchin.js">_uacct = "UA-2623231-3";
        urchinTracker();</script>
                    </head>
  <body class="composite">
    <div id="banner">
                  <a href="http://www.ops4j.org/index.html" id="bannerLeft">
    
                                            <img src="../images/logos/ops4j.png" alt="" />
    
            </a>
                        <a href="../index.html" id="bannerRight">
    
            Pax-Construct
    
            </a>
            <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
          
  

  
    
  
  
            <div class="xleft">
        Last Published: 02/12/2008
                      </div>
            <div class="xright">      <a href="http://wiki.ops4j.org/confluence/display/ops4j/Pax">Pax</a>
          |
          <a href="http://www.osgi.org/">OSGi</a>
          |
          <a href="http://maven.apache.org/">Maven 2</a>
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
           
  

  
    
  
  
                   <h5>Pax Construct</h5>
        <ul>
              
    <li class="none">
              <a href="../index.html">Getting Started</a>
        </li>
          </ul>
          <h5>Documentation</h5>
        <ul>
              
    <li class="none">
              <a href="index.html">Introduction</a>
        </li>
              
    <li class="none">
              <a href="plugin-info.html">Goals</a>
        </li>
              
    <li class="none">
              <strong>Usage</strong>
        </li>
          </ul>
          <h5>Status</h5>
        <ul>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-info.html">Project Information</a>
              </li>
              
                
              
      
            
      
            
      
            
      
            
      
            
      
              
        <li class="collapsed">
              <a href="project-reports.html">Project Reports</a>
              </li>
          </ul>
          <h5>Mailing List</h5>
        <ul>
              
    <li class="none">
              <a href="mailto:general@lists.ops4j.org">general@lists.ops4j.org</a>
        </li>
          </ul>
          <h5>Issue Tracking</h5>
        <ul>
              
    <li class="none">
              <a href="http://issues.ops4j.org/jira/browse/PAXCONSTRUCT">http://issues.ops4j.org</a>
        </li>
          </ul>
                                       <a href="http://maven.apache.org/" title="Built by Maven" id="poweredBy">
            <img alt="Built by Maven" src="./images/logos/maven-feather.png"></img>
          </a>
                       
  

  
    
  
  
        </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Maven 2 Pax Plugin: Usage</h2><div class="section"><h3>Adding the Pax Plugin to your build</h3><p>To use the current release in an existing project, you need to add the following to your POM:</p><div class="source"><pre>  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.ops4j&lt;/groupId&gt;
        &lt;artifactId&gt;maven-pax-plugin&lt;/artifactId&gt;
        &lt;version&gt;0.6.4&lt;/version&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

  &lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
      &lt;id&gt;ops4j-standard&lt;/id&gt;
      &lt;url&gt;http://repository.ops4j.org/maven2&lt;/url&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
      &lt;/snapshots&gt;
    &lt;/pluginRepository&gt;
  &lt;/pluginRepositories&gt;</pre></div></div><div class="section"><h3>Using the Pax Plugin from the command line</h3><p>The following example demonstrates various ways to build and deploy an OSGi project. We start by creating a project to contain the various bundles and move on to wrap the commons-logging jar, as well as its dependencies. The javax.* and com.sun.jdmk.comm packages are marked optional, as they are not available in some execution environments.</p><p>Next we create a simple API bundle, with an example service API, but no internals. The example implementation goes in another bundle, which doesn't contain an API, so we need to import the API before it can build. We also embed the junit library inside the bundle, just to demonstrate how easy this can be.</p><p>Finally we build and provision the project onto an OSGi framework.</p><p>(NOTE: the extra quotes are in case you want to try this in the Windows command shell, which requires quotes around arguments containing '=')</p><div class="source"><pre>mvn org.ops4j:maven-pax-plugin:create-project &quot;-DgroupId=my.example&quot; &quot;-DartifactId=project&quot;

cd project

mvn pax:wrap-jar &quot;-DartifactId=commons-logging&quot; &quot;-Dversion=1.1&quot; -DwrapTransitive \
                 &quot;-DimportPackage=javax.*|com.sun.jdmk.comm;resolution:=optional,*&quot;

mvn pax:create-bundle &quot;-DbundleName=simple-api&quot; &quot;-Dpackage=org.example.simple&quot; &quot;-Dinternals=false&quot;
mvn pax:create-bundle &quot;-DbundleName=simple-impl&quot; &quot;-Dpackage=org.example.simple&quot; &quot;-Dinterface=false&quot;

cd simple-impl
mvn pax:embed-jar &quot;-DartifactId=junit&quot; &quot;-Dversion=3.8.2&quot;
mvn pax:import-bundle &quot;-DartifactId=simple-api&quot;
cd ..

mvn clean install pax:provision</pre></div></div><div class="section"><h3>Save your keyboard and fingers - use the scripts!</h3><p>You can save a lot of typing by using the Pax-Construct scripts, which also provide basic help text (-h):</p><div class="source"><pre>pax-create-project -g my.example -a project

cd project

pax-wrap-jar -a commons-logging -v 1.1 -- -DwrapTransitive &quot;-DimportPackage=javax.*|com.sun.jdmk.comm;resolution:=optional,*&quot;

pax-create-bundle -n simple-api -p org.example.simple -- &quot;-Dinternals=false&quot;
pax-create-bundle -n simple-impl -p org.example.simple -- &quot;-Dinterface=false&quot;

cd simple-impl
pax-embed-jar -a junit -v 3.8.2
pax-import-bundle -a simple-api
cd ..

mvn clean install pax:provision</pre></div></div><div class="section"><h3>Using the Pax Plugin inside a POM</h3><p>Here's the same example, but this time using the Maven2 Invoker Plugin with the Pax Plugin to build and deploy an OSGi project:</p><div class="source"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd&quot;&gt;

  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
  &lt;groupId&gt;examples&lt;/groupId&gt;
  &lt;artifactId&gt;sample-project&lt;/artifactId&gt;
  &lt;version&gt;0.2.0&lt;/version&gt;

  &lt;name&gt;TEST ${artifactId}&lt;/name&gt;

  &lt;packaging&gt;pom&lt;/packaging&gt;

  &lt;properties&gt;
    &lt;sandpit&gt;target/example&lt;/sandpit&gt;
  &lt;/properties&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.ops4j&lt;/groupId&gt;
        &lt;artifactId&gt;maven-pax-plugin&lt;/artifactId&gt;
        &lt;version&gt;0.6.4&lt;/version&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;phase&gt;package&lt;/phase&gt;
&lt;!-- ======================================================================    
            CREATE NEW OSGi PROJECT
     ====================================================================== --&gt;
            &lt;goals&gt;
              &lt;goal&gt;create-project&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;!--
                don't create intermediate poms
              --&gt;
              &lt;attachPom&gt;false&lt;/attachPom&gt;
              &lt;groupId&gt;my.example&lt;/groupId&gt;
              &lt;artifactId&gt;project&lt;/artifactId&gt;
              &lt;targetDirectory&gt;
                ${sandpit}/${artifactId}
              &lt;/targetDirectory&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
      &lt;plugin&gt;
        &lt;artifactId&gt;maven-invoker-plugin&lt;/artifactId&gt;
        &lt;executions&gt;
          &lt;execution&gt;
            &lt;id&gt;wrap-logging&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              WRAP COMMONS LOGGING AS WELL AS ITS DEPENDENCIES
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;pax:wrap-jar&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;testProperties&gt;
                &lt;property&gt;
                  &lt;name&gt;artifactId&lt;/name&gt;
                  &lt;value&gt;commons-logging&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;version&lt;/name&gt;
                  &lt;value&gt;1.1&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;wrapTransitive&lt;/name&gt;
                  &lt;value&gt;true&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;importPackage&lt;/name&gt;
                  &lt;value&gt;javax.*|com.sun.jdmk.comm;resolution:=optional,*&lt;/value&gt;
                &lt;/property&gt;
              &lt;/testProperties&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;api-bundle&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              CREATE SIMPLE API OSGi BUNDLE
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;pax:create-bundle&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;testProperties&gt;
                &lt;property&gt;
                  &lt;name&gt;bundleName&lt;/name&gt;
                  &lt;value&gt;simple-api&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;package&lt;/name&gt;
                  &lt;value&gt;org.example.simple&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;internals&lt;/name&gt;
                  &lt;value&gt;false&lt;/value&gt;
                &lt;/property&gt;
              &lt;/testProperties&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;impl-bundle&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              CREATE SIMPLE IMPLEMENTATION OSGi BUNDLE
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;pax:create-bundle&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;testProperties&gt;
                &lt;property&gt;
                  &lt;name&gt;bundleName&lt;/name&gt;
                  &lt;value&gt;simple-impl&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;package&lt;/name&gt;
                  &lt;value&gt;org.example.simple&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;interface&lt;/name&gt;
                  &lt;value&gt;false&lt;/value&gt;
                &lt;/property&gt;
              &lt;/testProperties&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;embed-jar&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/simple-impl/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              EMBED JUNIT INSIDE THE IMPLEMENTATION BUNDLE
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;pax:embed-jar&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;testProperties&gt;
                &lt;property&gt;
                  &lt;name&gt;artifactId&lt;/name&gt;
                  &lt;value&gt;junit&lt;/value&gt;
                &lt;/property&gt;
                &lt;property&gt;
                  &lt;name&gt;version&lt;/name&gt;
                  &lt;value&gt;3.8.2&lt;/value&gt;
                &lt;/property&gt;
              &lt;/testProperties&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;import-api&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/simple-impl/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              IMPORT API INTO THE IMPLEMENTATION BUNDLE
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;pax:import-bundle&lt;/goal&gt;
              &lt;/goals&gt;
              &lt;testProperties&gt;
                &lt;property&gt;
                  &lt;name&gt;artifactId&lt;/name&gt;
                  &lt;value&gt;simple-api&lt;/value&gt;
                &lt;/property&gt;
              &lt;/testProperties&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
          &lt;execution&gt;
            &lt;id&gt;build&lt;/id&gt;
            &lt;phase&gt;package&lt;/phase&gt;
            &lt;goals&gt;
              &lt;goal&gt;run&lt;/goal&gt;
            &lt;/goals&gt;
            &lt;configuration&gt;
              &lt;pom&gt;${sandpit}/${artifactId}/project/pom.xml&lt;/pom&gt;
              &lt;noLog&gt;true&lt;/noLog&gt;
&lt;!-- ======================================================================    
              BUILD OSGi PROJECT
     ====================================================================== --&gt;
              &lt;goals&gt;
                &lt;goal&gt;install&lt;/goal&gt;
              &lt;/goals&gt;
            &lt;/configuration&gt;
          &lt;/execution&gt;
        &lt;/executions&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;

  &lt;pluginRepositories&gt;
    &lt;pluginRepository&gt;
      &lt;id&gt;ops4j-standard&lt;/id&gt;
      &lt;url&gt;http://repository.ops4j.org/maven2&lt;/url&gt;
      &lt;snapshots&gt;
        &lt;enabled&gt;false&lt;/enabled&gt;
      &lt;/snapshots&gt;
    &lt;/pluginRepository&gt;
  &lt;/pluginRepositories&gt;

&lt;/project&gt;</pre></div><p>Copy and paste the above XML to a new pom.xml file, then run the following commands to deploy the example on the Felix framework:</p><div class="source"><pre>mvn clean install

mvn pax:provision -f target/example/sample-project/project/pom.xml</pre></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">&#169;  
          2007-2008
    
          OPS4J
          
  

  
    
  
  
  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
