 ------
 Spring Dynamic Modules for OSGi(tm)
 ------
 Stuart McCulloch
 ------
 11 October 2007
 ------

~~ Copyright 2007 Stuart McCulloch
~~
~~ Licensed under the Apache License, Version 2.0 (the "License");
~~ you may not use this file except in compliance with the License.
~~ You may obtain a copy of the License at
~~
~~      http://www.apache.org/licenses/LICENSE-2.0
~~
~~ Unless required by applicable law or agreed to in writing, software
~~ distributed under the License is distributed on an "AS IS" BASIS,
~~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~~ See the License for the specific language governing permissions and
~~ limitations under the License.

~~ NOTE: For help with the syntax of this file, see:
~~ http://maven.apache.org/guides/mini/guide-apt-format.html

Spring Dynamic Modules for OSGi(tm)

 The following scripts use Pax-Construct to build and provision a minimal Spring Dynamic
 Modules for OSGi(tm) project using the current release candidate. It includes the sample
 weather service from the Spring DM build, as well as an example bean template.

 This setup requires a Java5 runtime. Some advanced features of Spring Dynamic Modules
 may require additional bundles to be imported, or extra third-party libraries wrapped.

* Download {{{SPRING_OSGI_EXAMPLE}UNIX}} shell script

* Download {{{SPRING_OSGI_EXAMPLE.bat}Windows}} batch file

** Using the scripts:

 If you have the Pax-Construct scripts installed and on your path, all you need to
 do is go to a temporary/working directory and run the script - it will create a
 new Maven project, populate it with various bundles and deploy them on the Felix
 OSGi framework. You can deploy to other frameworks by using -Dframework=<name>

** Create Eclipse project files for the various imported, wrapped and compiled bundles:

+---+
cd spring

mvn clean install pax:eclipse -DdownloadSources
+---+

 Use <"Import... Existing Projects into Workspace"> and point it to the top-most directory
 to import the bundle projects into your Eclipse Workspace.

** Example output when provisioning (assumes 'mvn clean install' has already been run)

+---+
cd spring

mvn pax:provision

[INFO] Scanning for projects...
[INFO] Reactor build order: 
[INFO]   examples.spring (OSGi project)
[INFO]   spring - plugin configuration
[INFO]   spring - wrapper instructions
[INFO]   spring - bundle instructions
[INFO]   spring - imported bundles
[INFO]   asm 2.2.3 [osgi]
[INFO]   aopalliance 1.0 [osgi]
[INFO]   javax.servlet.jsp-api 2.0 [osgi]
[INFO]   javax.servlet.api 2.5 [osgi]
[INFO]   
[INFO]   org.example.service
[INFO]   org.example.bean
[INFO] Searching repository for plugin with prefix: 'pax'.
[INFO] ----------------------------------------------------------------------------
[INFO] Building examples.spring (OSGi project)
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring - plugin configuration
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring - wrapper instructions
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring - bundle instructions
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring - imported bundles
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building asm 2.2.3 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building aopalliance 1.0 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building javax.servlet.jsp-api 2.0 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building javax.servlet.api 2.5 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building 
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building org.example.service
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building org.example.bean
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] Installing /tmp/spring/target/deployment/pom.xml to /home/stuart/.m2/repository/examples/spring/build/deployment/1.0-SNAPSHOT/deployment-1.0-SNAPSHOT.pom
    ______  ________  __  __
   / __  / /  __   / / / / /
  /  ___/ /  __   / _\ \ _/
 /  /    /  / /  / / _\ \
/__/    /__/ /__/ /_/ /_/

Pax Runner from OPS4J - http://www.ops4j.org
--------------------------------------------

 -> Using config [classpath:META-INF/runner.properties]
 -> Provision from [/tmp/spring/target/deployment/pom.xml]
 -> Provision from [scan-pom:file:/tmp/spring/target/deployment/pom.xml]
 -> Using property [org.osgi.service.http.port=8080]
 -> Using property [org.osgi.service.http.port.secure=8443]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-extender/1.0,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.slf4j/slf4j-api/1.4.3,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.slf4j/jcl104-over-slf4j/1.4.3,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-core/1.0,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-io/1.0,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework/spring-aop/2.5.1,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework/spring-beans/2.5.1,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework/spring-context/2.5.1,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework/spring-core/2.5.1,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.springframework/spring-test/2.5.1,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:org.slf4j/slf4j-simple/1.4.3,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring.wrappers/asm-2.2.3/001-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring.wrappers/aopalliance-1.0/001-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring.wrappers/javax.servlet.jsp-api-2.0/001-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring.wrappers/javax.servlet.api-2.5/001-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring/org.example.service/1.0-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Installing bundle [{location=mvn:examples.spring/org.example.bean/1.0-SNAPSHOT,startlevel=null,shouldStart=true,shouldUpdate=false}]
 -> Downloading bundles...
 -> mvn:org.springframework.osgi/spring-osgi-extender/1.0 : 64816 bytes @ [ 1157kBps ]
 -> mvn:org.slf4j/slf4j-api/1.4.3 : 15345 bytes @ [ 341kBps ]
 -> mvn:org.slf4j/jcl104-over-slf4j/1.4.3 : 15435 bytes @ [ 964kBps ]
 -> mvn:org.springframework.osgi/spring-osgi-core/1.0 : 244381 bytes @ [ 4213kBps ]
 -> mvn:org.springframework.osgi/spring-osgi-io/1.0 : 17667 bytes @ [ 8833kBps ]]
 -> mvn:org.springframework/spring-aop/2.5.1 : 323289 bytes @ [ 4825kBps ]
 -> mvn:org.springframework/spring-beans/2.5.1 : 467331 bytes @ [ 6401kBps ]
 -> mvn:org.springframework/spring-context/2.5.1 : 455159 bytes @ [ 6896kBps ]
 -> mvn:org.springframework/spring-core/2.5.1 : 275073 bytes @ [ 5393kBps ]
 -> mvn:org.springframework/spring-test/2.5.1 : 177608 bytes @ [ 9867kBps ]
 -> mvn:org.slf4j/slf4j-simple/1.4.3 : 7449 bytes @ [ 7449kBps ]
 -> mvn:examples.spring.wrappers/asm-2.2.3/001-SNAPSHOT : 37635 bytes @ [ 2688kBps ]
 -> mvn:examples.spring.wrappers/aopalliance-1.0/001-SNAPSHOT : 6437 bytes @ [ 6437kBps ]
 -> mvn:examples.spring.wrappers/javax.servlet.jsp-api-2.0/001-SNAPSHOT : 53386 bytes @ [ 2224kBps ]
 -> mvn:examples.spring.wrappers/javax.servlet.api-2.5/001-SNAPSHOT : 108101 bytes @ [ 3487kBps ]
 -> mvn:examples.spring/org.example.service/1.0-SNAPSHOT : 5072 bytes @ [ 5072kBps ]
 -> mvn:examples.spring/org.example.bean/1.0-SNAPSHOT : 4601 bytes @ [ 4601kBps ]
 -> Execution environment [J2SE-1.5]
 -> Starting platform [Felix 1.0.1]. Runner has succesfully finished his job!

Welcome to Felix.
=================

-> 441 [FelixStartLevel] INFO org.springframework.osgi.extender.internal.ContextLoaderListener - Starting org.springframework.osgi.extender bundle v.[1.0.0]
STARTING org.example.service
REGISTER org.example.service.ExampleService
584 [FelixStartLevel] INFO org.springframework.osgi.extender.internal.ContextLoaderListener - disabled automatic Spring-DM annotation processing; [ org.springframework.osgi.extender.annotation.auto.processing=null]
637 [SpringOsgiExtenderThread-1] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Refreshing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@53065306: display name [OsgiBundleXmlApplicationContext(bundle=org.example.bean, config=osgibundle:/META-INF/spring/*.xml)]; startup date [Wed Feb 06 18:36:31 GMT+08:00 2008]; root of context hierarchy
788 [SpringOsgiExtenderThread-1] INFO org.springframework.beans.factory.xml.XmlBeanDefinitionReader - Loading XML bean definitions from URL [bundle://20.0:0/META-INF/spring/bundle-context-osgi.xml]
1206 [SpringOsgiExtenderThread-1] INFO org.springframework.beans.factory.xml.XmlBeanDefinitionReader - Loading XML bean definitions from URL [bundle://20.0:0/META-INF/spring/bundle-context.xml]
1312 [SpringOsgiExtenderThread-1] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Bean factory for application context [org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@53065306]: org.springframework.beans.factory.support.DefaultListableBeanFactory@26b026b0
1391 [SpringOsgiExtenderThread-2] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@26b026b0: defining beans [myExampleBean]; root of factory hierarchy
1417 [SpringOsgiExtenderThread-2] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Publishing application context with properties (org.springframework.context.service.name=org.example.bean)

-> ps

START LEVEL 6
   ID   State         Level  Name
[   0] [Active     ] [    0] System Bundle (1.0.1)
[   1] [Active     ] [    1] R4 Compendium (1.0.0)
[   2] [Active     ] [    1] Apache Felix Shell Service (1.0.0)
[   3] [Active     ] [    1] Apache Felix Shell TUI (1.0.0)
[   4] [Active     ] [    5] spring-osgi-extender (1.0)
[   5] [Active     ] [    5] slf4j-api (1.4.3)
[   6] [Active     ] [    5] jcl104-over-slf4j (1.4.3)
[   7] [Active     ] [    5] spring-osgi-core (1.0)
[   8] [Active     ] [    5] spring-osgi-io (1.0)
[   9] [Active     ] [    5] spring-aop (2.5.1)
[  10] [Active     ] [    5] spring-beans (2.5.1)
[  11] [Active     ] [    5] spring-context (2.5.1)
[  12] [Active     ] [    5] spring-core (2.5.1)
[  13] [Active     ] [    5] spring-test (2.5.1)
[  14] [Active     ] [    5] slf4j-simple (1.4.3)
[  15] [Active     ] [    5] asm 2.2.3 [osgi] (2.2.3)
[  16] [Active     ] [    5] aopalliance 1.0 [osgi] (1.0)
[  17] [Active     ] [    5] javax.servlet.jsp-api 2.0 [osgi] (2.0)
[  18] [Active     ] [    5] javax.servlet.api 2.5 [osgi] (2.5)
[  19] [Active     ] [    5] org.example.service (1.0.0.SNAPSHOT)
[  20] [Active     ] [    5] org.example.bean (1.0.0.SNAPSHOT)

-> services

System Bundle (0) provides:
---------------------------
org.osgi.service.packageadmin.PackageAdmin
org.osgi.service.startlevel.StartLevel

Apache Felix Shell Service (2) provides:
----------------------------------------
org.apache.felix.shell.ShellService, org.ungoverned.osgi.service.shell.ShellService

spring-osgi-extender (4) provides:
----------------------------------
org.springframework.beans.factory.xml.NamespaceHandlerResolver
org.xml.sax.EntityResolver

org.example.service (19) provides:
----------------------------------
org.example.service.ExampleService

org.example.bean (20) provides:
-------------------------------
org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext, org.springframework.osgi.context.support.AbstractDelegatedExecutionApplicationContext, org.springframework.osgi.context.DelegatedExecutionOsgiBundleApplicationContext, org.springframework.osgi.context.ConfigurableOsgiBundleApplicationContext, org.springframework.context.ConfigurableApplicationContext, org.springframework.context.ApplicationContext, org.springframework.context.Lifecycle, org.springframework.beans.factory.ListableBeanFactory, org.springframework.beans.factory.HierarchicalBeanFactory, org.springframework.context.MessageSource, org.springframework.context.ApplicationEventPublisher, org.springframework.core.io.support.ResourcePatternResolver, org.springframework.beans.factory.BeanFactory, org.springframework.core.io.ResourceLoader, org.springframework.osgi.context.support.AbstractOsgiBundleApplicationContext, org.springframework.context.support.AbstractRefreshableApplicationContext, org.springframework.context.support.AbstractApplicationContext, org.springframework.beans.factory.DisposableBean, org.springframework.core.io.DefaultResourceLoader

-> stop 0

7887 [Felix Shell TUI] INFO org.springframework.osgi.extender.internal.ContextLoaderListener - Stopping org.springframework.osgi.extender bundle
7894 [Thread-2] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Closing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@53065306: display name [OsgiBundleXmlApplicationContext(bundle=org.example.bean, config=osgibundle:/META-INF/spring/*.xml)]; startup date [Wed Feb 06 18:36:31 GMT+08:00 2008]; root of context hierarchy
7895 [Thread-2] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Destroying singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@26b026b0: defining beans [myExampleBean]; root of factory hierarchy
-> STOPPING org.example.service
[INFO] 
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] ------------------------------------------------------------------------
[INFO] examples.spring (OSGi project) ........................ SUCCESS [3.995s]
[INFO] spring - plugin configuration ......................... SUCCESS [0.001s]
[INFO] spring - wrapper instructions ......................... SUCCESS [0.001s]
[INFO] spring - bundle instructions .......................... SUCCESS [0.001s]
[INFO] spring - imported bundles ............................. SUCCESS [0.193s]
[INFO] asm 2.2.3 [osgi] ...................................... SUCCESS [0.019s]
[INFO] aopalliance 1.0 [osgi] ................................ SUCCESS [0.003s]
[INFO] javax.servlet.jsp-api 2.0 [osgi] ...................... SUCCESS [0.031s]
[INFO] javax.servlet.api 2.5 [osgi] .......................... SUCCESS [0.004s]
[INFO]  ...................................................... SUCCESS [0.002s]
[INFO] org.example.service ................................... SUCCESS [0.003s]
[INFO] org.example.bean ...................................... SUCCESS [10.604s]
[INFO] ------------------------------------------------------------------------
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 15 seconds
[INFO] Finished at: Wed Feb 06 18:36:38 GMT+08:00 2008
[INFO] Final Memory: 9M/41M
[INFO] ------------------------------------------------------------------------
 -> Shuting down platform...
 -> Destroying platform process...
+---+

