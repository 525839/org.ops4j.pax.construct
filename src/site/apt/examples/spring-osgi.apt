 ------
 Spring Dynamic Modules for OSGi(tm)
 ------
 Stuart McCulloch
 ------
 11 October 2007
 ------

~~ Copyright 2007 Stuart McCulloch
~~
~~ Licensed under the Apache License, Version 2.0 (the "License");
~~ you may not use this file except in compliance with the License.
~~ You may obtain a copy of the License at
~~
~~      http://www.apache.org/licenses/LICENSE-2.0
~~
~~ Unless required by applicable law or agreed to in writing, software
~~ distributed under the License is distributed on an "AS IS" BASIS,
~~ WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
~~ See the License for the specific language governing permissions and
~~ limitations under the License.

~~ NOTE: For help with the syntax of this file, see:
~~ http://maven.apache.org/guides/mini/guide-apt-format.html

Spring Dynamic Modules for OSGi(tm)

 The following scripts use Pax-Construct to build and provision Milestone 3 of
 the Spring Dynamic Modules for OSGi(tm) along with the sample weather service.
 This example requires a Java5 runtime.

* Download {{{SPRING_OSGI_EXAMPLE}UNIX}} shell script

* Download {{{SPRING_OSGI_EXAMPLE.bat}Windows}} batch file

** Create Eclipse project files for the various imported, wrapped and compiled bundles:

+---+
mvn clean install pax:eclipse -DdownloadSources
+---+

** Example output when provisioning (assumes 'mvn clean install' has already been run)

+---+
mvn pax:provision 

[INFO] Scanning for projects...
[INFO] Reactor build order: 
[INFO]   examples.spring-osgi-example (OSGi project)
[INFO]   spring-osgi-example - plugin configuration
[INFO]   spring-osgi-example - wrapper instructions
[INFO]   spring-osgi-example - bundle instructions
[INFO]   spring-osgi-example - imported bundles
[INFO]   backport-util-concurrent 3.0 [osgi]
[INFO]   commons-collections 3.2 [osgi]
[INFO]   asm 2.2.3 [osgi]
[INFO]   aopalliance 1.0 [osgi]
[INFO]   javax.servlet.servlet-api 2.5 [osgi]
[INFO]   javax.servlet.jsp-api 2.0 [osgi]
[INFO]   junit 3.8.2 [osgi]
[INFO]   
[INFO] Searching repository for plugin with prefix: 'pax'.
[INFO] ----------------------------------------------------------------------------
[INFO] Building examples.spring-osgi-example (OSGi project)
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring-osgi-example - plugin configuration
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring-osgi-example - wrapper instructions
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring-osgi-example - bundle instructions
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building spring-osgi-example - imported bundles
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building backport-util-concurrent 3.0 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building commons-collections 3.2 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building asm 2.2.3 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building aopalliance 1.0 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building javax.servlet.servlet-api 2.5 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building javax.servlet.jsp-api 2.0 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building junit 3.8.2 [osgi]
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] Building 
[INFO]    task-segment: [pax:provision]
[INFO] ----------------------------------------------------------------------------
[INFO] [pax:provision]
[INFO] Installing /tmp/spring-osgi-example/target/deployment/pom.xml to /home/stuart/.m2/repository/examples/spring-osgi-example/build/deployment/1.0-SNAPSHOT/deployment-1.0-SNAPSHOT.pom
    ______  ________  __  __
   / __  / /  __   / / / / /
  /  ___/ /  __   / _\ \ _/
 /  /    /  / /  / / _\ \
/__/    /__/ /__/ /_/ /_/

Pax Runner from OPS4J - http://www.ops4j.org
--------------------------------------------

 -> Using config [classpath:META-INF/runner.properties]
 -> Protocol [mvn] handler started
 -> Protocol [wrap] handler started
 -> Scanner for schema [scan-bundle] started
 -> Scanner for schema [scan-dir] started
 -> Scanner for schema [scan-file] started
 -> Scanner for schema [scan-pom] started
 -> Provision from [/tmp/spring-osgi-example/target/deployment/pom.xml]
 -> Provision from [scan-pom:file:/tmp/spring-osgi-example/target/deployment/pom.xml]
 -> Using property [org.osgi.service.http.port=8080]
 -> Using property [org.osgi.service.http.port.secure=8443]
 -> Installing bundle [{location=mvn:org.springframework/spring-test/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework/spring-core/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-core/1.0-rc1-SNAPSHOT,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.slf4j/slf4j-simple/1.4.3,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/javax.servlet.servlet-api-2.5/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/asm-2.2.3/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-io/1.0-rc1-SNAPSHOT,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.slf4j/slf4j-api/1.4.3,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/backport-util-concurrent-3.0/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/javax.servlet.jsp-api-2.0/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/aopalliance-1.0/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework/spring-beans/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework/spring-aop/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework.osgi.samples/weather-service/1.0-rc1-SNAPSHOT,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework/spring-context/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework/spring-web/2.1-m4,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/commons-collections-3.2/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework.osgi/spring-osgi-extender/1.0-rc1-SNAPSHOT,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.slf4j/jcl104-over-slf4j/1.4.3,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:examples.spring-osgi-example/junit-3.8.2/001,startlevel=null,shouldStart=true}]
 -> Installing bundle [{location=mvn:org.springframework.osgi.samples/weather-dao/1.0-rc1-SNAPSHOT,startlevel=null,shouldStart=true}]
 -> Downloading bundles...
 -> mvn:org.springframework/spring-test/2.1-m4 : 160767 bytes @ [ 3091kBps ]
 -> mvn:org.springframework/spring-core/2.1-m4 : 202751 bytes @ [ 7241kBps ]
 -> mvn:org.springframework.osgi/spring-osgi-core/1.0-rc1-SNAPSHOT : 212991 bytes @ [ 6454kBps ]
 -> mvn:org.slf4j/slf4j-simple/1.4.3 : 7167 bytes @ [ 7167kBps ]
 -> mvn:examples.spring-osgi-example/javax.servlet.servlet-api-2.5/001 : 107519 bytes @ [ 7679kBps ]
 -> mvn:examples.spring-osgi-example/asm-2.2.3/001 : 36863 bytes @ [ 4095kBps ]
 -> mvn:org.springframework.osgi/spring-osgi-io/1.0-rc1-SNAPSHOT : 13311 bytes @ [ 6655kBps ]]
 -> mvn:org.slf4j/slf4j-api/1.4.3 : 14335 bytes @ [ 14335kBps ]
 -> mvn:examples.spring-osgi-example/backport-util-concurrent-3.0/001 : 333823 bytes @ [ 6676kBps ]
 -> mvn:examples.spring-osgi-example/javax.servlet.jsp-api-2.0/001 : 53247 bytes @ [ 8874kBps ]
 -> mvn:examples.spring-osgi-example/aopalliance-1.0/001 : 6143 bytes @ [ 6143kBps ]
 -> mvn:org.springframework/spring-beans/2.1-m4 : 454655 bytes @ [ 7453kBps ]
 -> mvn:org.springframework/spring-aop/2.1-m4 : 319487 bytes @ [ 6655kBps ]
 -> mvn:org.springframework.osgi.samples/weather-service/1.0-rc1-SNAPSHOT : 5119 bytes @ [ 5119kBps ]
 -> mvn:org.springframework/spring-context/2.1-m4 : 397311 bytes @ [ 6621kBps ]
 -> mvn:org.springframework/spring-web/2.1-m4 : 178175 bytes @ [ 6363kBps ]
 -> mvn:examples.spring-osgi-example/commons-collections-3.2/001 : 580607 bytes @ [ 6830kBps ]
 -> mvn:org.springframework.osgi/spring-osgi-extender/1.0-rc1-SNAPSHOT : 51199 bytes @ [ 8533kBps ]]
 -> mvn:org.slf4j/jcl104-over-slf4j/1.4.3 : 15359 bytes @ [ 7679kBps ]]
 -> mvn:examples.spring-osgi-example/junit-3.8.2/001 : 122879 bytes @ [ 6467kBps ]
 -> mvn:org.springframework.osgi.samples/weather-dao/1.0-rc1-SNAPSHOT : 5119 bytes @ [ 5119kBps ]
 -> Execution environment [J2SE-1.5]
 -> Starting platform [Felix]. Runner has succesfully finished his job!

Welcome to Felix.
=================

-> 537 [FelixStartLevel] INFO org.springframework.osgi.internal.extender.ContextLoaderListener - Starting org.springframework.osgi.extender bundle v.[1.0.0.rc1_SNAPSHOT]
761 [SpringOsgiExtenderThread-1] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Refreshing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@73207320: display name [OsgiBundleXmlApplicationContext(bundle=org.springframework.osgi.samples.weather.service, config=osgibundlejar:/META-INF/spring/*.xml)]; startup date [Sun Oct 21 18:44:51 GMT+08:00 2007]; root of context hierarchy
761 [SpringOsgiExtenderThread-2] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Refreshing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@4a1a4a1a: display name [OsgiBundleXmlApplicationContext(bundle=org.springframework.osgi.samples.weather-dao, config=osgibundlejar:/META-INF/spring/*.xml)]; startup date [Sun Oct 21 18:44:51 GMT+08:00 2007]; root of context hierarchy
870 [SpringOsgiExtenderThread-1] INFO org.springframework.beans.factory.xml.XmlBeanDefinitionReader - Loading XML bean definitions from OSGi res[/META-INF/spring/weather-service-context.xml|17|symName=org.springframework.osgi.samples.weather.service]
870 [SpringOsgiExtenderThread-2] INFO org.springframework.beans.factory.xml.XmlBeanDefinitionReader - Loading XML bean definitions from OSGi res[/META-INF/spring/weather-dao-context.xml|24|symName=org.springframework.osgi.samples.weather-dao]
1412 [SpringOsgiExtenderThread-2] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Bean factory for application context [org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@4a1a4a1a]: org.springframework.beans.factory.support.DefaultListableBeanFactory@32fa32fa
1475 [SpringOsgiExtenderThread-3] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@32fa32fa: defining beans [weatherDao,org.springframework.osgi.service.exporter.OsgiServiceFactoryBean#0]; root of factory hierarchy
1511 [SpringOsgiExtenderThread-1] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Bean factory for application context [org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@73207320]: org.springframework.beans.factory.support.DefaultListableBeanFactory@2c542c54
1513 [SpringOsgiExtenderThread-4] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@2c542c54: defining beans [weatherService,org.springframework.osgi.service.exporter.OsgiServiceFactoryBean#0]; root of factory hierarchy
1655 [SpringOsgiExtenderThread-3] INFO org.springframework.osgi.service.exporter.OsgiServiceFactoryBean - Publishing service under classes [{org.springframework.osgi.samples.weather.dao.WeatherDao}]
1658 [SpringOsgiExtenderThread-3] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Publishing application context with properties (org.springframework.context.service.name=org.springframework.osgi.samples.weather-dao)
1800 [SpringOsgiExtenderThread-4] INFO org.springframework.osgi.service.exporter.OsgiServiceFactoryBean - Publishing service under classes [{org.springframework.osgi.samples.weather.service.WeatherService}]
1800 [SpringOsgiExtenderThread-4] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Publishing application context with properties (org.springframework.context.service.name=org.springframework.osgi.samples.weather.service)

-> ps
START LEVEL 6
   ID   State         Level  Name
[   0] [Active     ] [    0] System Bundle (1.0.0)
[   1] [Active     ] [    1] org.osgi.r4.compendium (1.0.0)
[   2] [Active     ] [    1] Apache Felix Shell Service (1.0.0)
[   3] [Active     ] [    1] Apache Felix Shell TUI (1.0.0)
[   4] [Active     ] [    5] spring-test (2.1.0.m4)
[   5] [Active     ] [    5] spring-core (2.1.0.m4)
[   6] [Active     ] [    5] spring-osgi-core (1.0.0.rc1_SNAPSHOT)
[   7] [Active     ] [    5] slf4j-simple (1.4.3)
[   8] [Active     ] [    5] javax.servlet.servlet-api 2.5 [osgi] (2.5)
[   9] [Active     ] [    5] asm 2.2.3 [osgi] (2.2.3)
[  10] [Active     ] [    5] spring-osgi-io (1.0.0.rc1_SNAPSHOT)
[  11] [Active     ] [    5] slf4j-api (1.4.3)
[  12] [Active     ] [    5] backport-util-concurrent 3.0 [osgi] (3.0)
[  13] [Active     ] [    5] javax.servlet.jsp-api 2.0 [osgi] (2.0)
[  14] [Active     ] [    5] aopalliance 1.0 [osgi] (1.0)
[  15] [Active     ] [    5] spring-beans (2.1.0.m4)
[  16] [Active     ] [    5] spring-aop (2.1.0.m4)
[  17] [Active     ] [    5] weather.service (1.0)
[  18] [Active     ] [    5] spring-context (2.1.0.m4)
[  19] [Active     ] [    5] spring-web (2.1.0.m4)
[  20] [Active     ] [    5] commons-collections 3.2 [osgi] (3.2)
[  21] [Active     ] [    5] spring-osgi-extender (1.0.0.rc1_SNAPSHOT)
[  22] [Active     ] [    5] jcl104-over-slf4j (1.4.3)
[  23] [Active     ] [    5] junit 3.8.2 [osgi] (3.8.2)
[  24] [Active     ] [    5] weather-dao (1.0.0.rc1_SNAPSHOT)
-> stop 0
7785 [Felix Shell TUI] INFO org.springframework.osgi.internal.extender.ContextLoaderListener - Stopping org.springframework.osgi.extender bundle
7795 [Thread-2] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Closing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@73207320: display name [OsgiBundleXmlApplicationContext(bundle=org.springframework.osgi.samples.weather.service, config=osgibundlejar:/META-INF/spring/*.xml)]; startup date [Sun Oct 21 18:44:51 GMT+08:00 2007]; root of context hierarchy
7796 [Thread-2] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Destroying singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@2c542c54: defining beans [weatherService,org.springframework.osgi.service.exporter.OsgiServiceFactoryBean#0]; roo-t>  of factory hierarchy
7802 [Thread-2] INFO org.springframework.osgi.service.exporter.OsgiServiceFactoryBean - Unregistered service [ServiceWrapper for org.apache.felix.framework.ServiceRegistrationImpl@4f2a4f2a]
7803 [Thread-3] INFO org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext - Closing org.springframework.osgi.context.support.OsgiBundleXmlApplicationContext@4a1a4a1a: display name [OsgiBundleXmlApplicationContext(bundle=org.springframework.osgi.samples.weather-dao, config=osgibundlejar:/META-INF/spring/*.xml)]; startup date [Sun Oct 21 18:44:51 GMT+08:00 2007]; root of context hierarchy
7804 [Thread-3] INFO org.springframework.beans.factory.support.DefaultListableBeanFactory - Destroying singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@32fa32fa: defining beans [weatherDao,org.springframework.osgi.service.exporter.OsgiServiceFactoryBean#0]; root of factory hierarchy
7805 [Thread-3] INFO org.springframework.osgi.service.exporter.OsgiServiceFactoryBean - Unregistered service [ServiceWrapper for org.apache.felix.framework.ServiceRegistrationImpl@39f839f8]
[INFO] 
[INFO] 
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] ------------------------------------------------------------------------
[INFO] examples.spring-osgi-example (OSGi project) ........... SUCCESS [3.102s]
[INFO] spring-osgi-example - plugin configuration ............ SUCCESS [0.001s]
[INFO] spring-osgi-example - wrapper instructions ............ SUCCESS [0.001s]
[INFO] spring-osgi-example - bundle instructions ............. SUCCESS [0.001s]
[INFO] spring-osgi-example - imported bundles ................ SUCCESS [0.001s]
[INFO] backport-util-concurrent 3.0 [osgi] ................... SUCCESS [0.002s]
[INFO] commons-collections 3.2 [osgi] ........................ SUCCESS [0.001s]
[INFO] asm 2.2.3 [osgi] ...................................... SUCCESS [0.006s]
[INFO] aopalliance 1.0 [osgi] ................................ SUCCESS [0.001s]
[INFO] javax.servlet.servlet-api 2.5 [osgi] .................. SUCCESS [0.001s]
[INFO] javax.servlet.jsp-api 2.0 [osgi] ...................... SUCCESS [0.001s]
[INFO] junit 3.8.2 [osgi] .................................... SUCCESS [0.002s]
[INFO]  ...................................................... SUCCESS [10.606s]
[INFO] ------------------------------------------------------------------------
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 14 seconds
[INFO] Finished at: Sun Oct 21 18:44:59 GMT+08:00 2007
[INFO] Final Memory: 8M/33M
[INFO] ------------------------------------------------------------------------
 -> Shuting down platform...
 -> Destroying platform process...
+---+

